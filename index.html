<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>İngilizce Kelime Ezberleme</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .input-group {
      margin-bottom: 15px;
    }
    input, textarea, button, select {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }
button.delete-btn {
  background-color: #f44336;
  width: auto;
  margin-left: 10px;
  padding: 5px 10px;
  font-size: 14px;
}

    #user-section, #word-input-section, #meaning-container {
      margin-bottom: 20px;
    }
    #word-list {
      margin-top: 20px;
    }
    .word-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f9f9f9;
      padding: 10px 15px;
      margin-bottom: 8px;
      border-radius: 5px;
      border-left: 4px solid #4CAF50;
    }
    .word-text {
      flex: 1;
    }
    .word-text strong {
      color: #4CAF50;
    }
    .user-badge {
      display: inline-block;
      background: #2196F3;
      color: white;
      padding: 3px 8px;
      border-radius: 15px;
      font-size: 12px;
      margin-left: 5px;
    }
    .hidden {
      display: none;
    }
    .loading {
      text-align: center;
      color: #666;
      font-style: italic;
    }
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      .word-item {
        flex-direction: column;
        align-items: flex-start;
      }
      .word-item button {
        margin-top: 10px;
        width: 100%;
      }
      input, textarea, button, select {
        font-size: 14px;
      }
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
  <div class="container">
    <h1>İngilizce Kelime Ezberleme</h1>

    <div id="user-section">
      <div class="input-group">
        <input type="text" id="username-input" placeholder="Kullanıcı Adı">
        <button id="login-btn">Giriş Yap / Kayıt Ol</button>
      </div>
    </div>

    <div id="word-input-section" class="hidden">
      <div class="input-group">
        <input type="text" id="word-input" placeholder="Kelime Gir">
        <button id="submit-word">Gönder</button>
      </div>

      <div id="meaning-container" class="hidden">
        <textarea id="meaning-input" placeholder="Anlamını Yaz"></textarea>
        <button id="save-word">Kaydet</button>
      </div>

      <div class="input-group">
        <select id="user-filter"></select>
      </div>
    </div>

    <div id="word-list">
      <h2>Kelime Listesi</h2>
      <div id="loading" class="loading">Yükleniyor...</div>
    </div>
  </div>

  <script>
     const firebaseConfig = {
         apiKey: "AIzaSyAlQR7p6gwbYlRmIVTVXDjvhi79Ms_vcvM",
         authDomain: "words-2a5f2.firebaseapp.com",
        databaseURL: "https://words-2a5f2-default-rtdb.firebaseio.com",
         projectId: "words-2a5f2",
         storageBucket: "words-2a5f2.firebasestorage.app",
         messagingSenderId: "469414272332",
         appId: "1:469414272332:web:4441813c6188a41a20c3e9"
     };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const userSection = document.getElementById("user-section");
    const wordInputSection = document.getElementById("word-input-section");
    const usernameInput = document.getElementById("username-input");
    const loginBtn = document.getElementById("login-btn");
    const wordInput = document.getElementById("word-input");
    const submitWordBtn = document.getElementById("submit-word");
    const meaningContainer = document.getElementById("meaning-container");
    const meaningInput = document.getElementById("meaning-input");
    const saveWordBtn = document.getElementById("save-word");
    const wordList = document.getElementById("word-list");
    const userFilter = document.getElementById("user-filter");
    const loadingElement = document.getElementById("loading");

    let currentUser = null;

    document.addEventListener("DOMContentLoaded", function () {
      checkSavedUser();
    });

    loginBtn.addEventListener("click", function () {
      const username = usernameInput.value.trim();
      if (username === "") {
        alert("Lütfen bir kullanıcı adı girin!");
        return;
      }
      const cleanUsername = username.replace(/[.#$\[\]]/g, "");
      if (cleanUsername !== username) {
        alert("Kullanıcı adında özel karakter kullanamazsınız!");
        return;
      }
      currentUser = cleanUsername;
      localStorage.setItem("currentUser", currentUser);
      userSection.classList.add("hidden");
      wordInputSection.classList.remove("hidden");
      loadUsers();
    });

    submitWordBtn.addEventListener("click", function () {
      const word = wordInput.value.trim();
      if (word === "") {
        alert("Lütfen bir kelime girin!");
        return;
      }
      const wordsRef = database.ref("words");
      wordsRef.orderByChild("word").equalTo(word).once("value", function(snapshot) {
        let duplicate = false;
        snapshot.forEach(function(child) {
          if (child.val().user === currentUser) {
            duplicate = true;
          }
        });
        if (duplicate) {
          alert("Bu kelimeyi zaten eklediniz!");
        } else {
          meaningContainer.classList.remove("hidden");
        }
      });
    });

    saveWordBtn.addEventListener("click", function () {
      const word = wordInput.value.trim();
      const meaning = meaningInput.value.trim();
      if (word === "" || meaning === "") {
        alert("Lütfen kelime ve anlamını girin!");
        return;
      }
      const newWord = {
        word,
        meaning,
        user: currentUser,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      };
      database.ref("words").push(newWord);
      wordInput.value = "";
      meaningInput.value = "";
      meaningContainer.classList.add("hidden");
    });

    userFilter.addEventListener("change", function () {
      loadWords();
    });

    function checkSavedUser() {
      const savedUser = localStorage.getItem("currentUser");
      if (savedUser) {
        currentUser = savedUser;
        userSection.classList.add("hidden");
        wordInputSection.classList.remove("hidden");
        loadUsers();
      }
    }

    function loadUsers() {
      database.ref("users").once("value").then((snapshot) => {
        const users = snapshot.val() || {};
        if (!users[currentUser]) {
          database.ref("users/" + currentUser).set(true);
        }
        updateUserFilter(Object.keys(users));
      });
    }

    function updateUserFilter(users) {
      userFilter.innerHTML = '';
      const allOption = document.createElement("option");
      allOption.value = "all";
      allOption.textContent = "Tüm Kullanıcılar";
      userFilter.appendChild(allOption);
      const meOption = document.createElement("option");
      meOption.value = "me";
      meOption.textContent = "Sadece Benim Kelimelerim";
      userFilter.appendChild(meOption);
      users.forEach(user => {
        const option = document.createElement("option");
        option.value = user;
        option.textContent = user;
        userFilter.appendChild(option);
      });
      loadWords();
    }

    function loadWords() {
      loadingElement.style.display = "block";
      wordList.innerHTML = '<h2>Kelime Listesi</h2>';
      wordList.appendChild(loadingElement);

      database.ref("words").orderByChild("timestamp").on("value", function(snapshot) {
        const words = [];
        snapshot.forEach(function(child) {
          const word = child.val();
          word.id = child.key;
          words.push(word);
        });

        const selectedUser = userFilter.value;
        const filteredWords = selectedUser === "all"
          ? words
          : selectedUser === "me"
            ? words.filter(word => word.user === currentUser)
            : words.filter(word => word.user === selectedUser);

        filteredWords.sort((a, b) => a.word.localeCompare(b.word));

        displayWords(filteredWords);
      });
    }

    function displayWords(words) {
      wordList.innerHTML = '<h2>Kelime Listesi</h2>';
      if (words.length === 0) {
        wordList.innerHTML += '<p>Henüz kelime eklenmedi.</p>';
        return;
      }
      words.forEach(word => {
        const wordItem = document.createElement("div");
        wordItem.className = "word-item";

        const wordText = document.createElement("div");
        wordText.className = "word-text";
        wordText.innerHTML = `<strong>${word.word}</strong>: ${word.meaning} <span class="user-badge">${word.user}</span>`;

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.textContent = "Sil";
        deleteBtn.onclick = function () {
          if (word.user === currentUser) {
            deleteWord(word.id);
          } else {
            alert("Sadece kendi kelimelerinizi silebilirsiniz!");
          }
        };

        wordItem.appendChild(wordText);
        if (word.user === currentUser) {
          wordItem.appendChild(deleteBtn);
        }
        wordList.appendChild(wordItem);
      });
    }

    function deleteWord(wordId) {
      if (confirm("Bu kelimeyi silmek istediğinize emin misiniz?")) {
        database.ref("words/" + wordId).remove();
      }
    }
  </script>
</body>
</html>
